{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="text-center mb-3">ðŸ’¬ Library Chatbot Assistant</h2>
  
  <div id="chat-box" class="border rounded p-3 mb-3" style="height: 400px; overflow-y: auto; background: #f8f9fa;">
    <div class="text-muted text-center">Chat started. Ask me about books or reservations!</div>
  </div>

  <div class="input-group">
    <input type="text" id="user-input" class="form-control" placeholder="Type your message...">
    <button id="send-btn" class="btn btn-primary">Send</button>
  </div>
</div>

<script>
document.getElementById('send-btn').addEventListener('click', sendMessage);
document.getElementById('user-input').addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMessage();
});

function appendMessage(sender, message) {
  const box = document.getElementById('chat-box');
  const div = document.createElement('div');
  div.innerHTML = `<b>${sender}:</b> ${message}`;
  div.classList.add('mb-2');
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById('user-input');
  const message = input.value.trim();
  if (!message) return;

  appendMessage('You', message);
  input.value = '';

  const res = await fetch('/chatbot_api', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message })
  });

  const data = await res.json();
  appendMessage('ðŸ¤– Bot', data.response);
}
</script>
{% endblock %}
