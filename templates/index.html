{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Available Books</h2>
  <form class="d-flex" method="GET" action="{{ url_for('main.index') }}">
    <input class="form-control me-2" type="search" name="q" placeholder="Search by title/author/category" value="{{ q }}">
    <select name="sort" class="form-select me-2">
      <option value="title" {% if sort=='title' %}selected{% endif %}>Sort: Title</option>
      <option value="author" {% if sort=='author' %}selected{% endif %}>Sort: Author</option>
      <option value="available" {% if sort=='available' %}selected{% endif %}>Sort: Available</option>
    </select>
    <button class="btn btn-outline-light" type="submit">Search</button>
  </form>
</div>

<div class="row mb-4">
  <div class="col-md-8">
    <div class="row">
      {% for book in books %}
      <div class="col-md-4 mb-3">
        <div class="card h-100">
          {% if book.cover_url %}
          <img src="{{ book.cover_url }}" class="card-img-top" alt="{{ book.title }}" style="height:180px; object-fit:cover;">
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ book.title }}</h5>
            <p class="card-text small">by {{ book.author }}</p>
            <p class="card-text"><small>Category: {{ book.category }}</small></p>
            <p class="card-text mt-auto"><strong>Copies:</strong> {{ book.available_copies }}</p>
            <a href="{{ url_for('main.book_detail', book_id=book.id) }}" class="btn btn-primary">View</a>

          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
      <ul class="pagination">
        {% if pagination.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('main.index', q=q, category=category, sort=sort, page=pagination.prev_num) }}">Previous</a>
        </li>
        {% endif %}
        {% for p in range(1, pagination.pages + 1) %}
        <li class="page-item {% if p == pagination.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('main.index', q=q, category=category, sort=sort, page=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        {% if pagination.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('main.index', q=q, category=category, sort=sort, page=pagination.next_num) }}">Next</a>
        </li>
        {% endif %}
      </ul>
    </nav>
  </div>

  <div class="col-md-4">
    <h5>Trending</h5>
    <ul class="list-group mb-3">
      {% for t in trending %}
      <li class="list-group-item">
        <a href="{{ url_for('main.book_detail', book_id=t.id) }}">{{ t.title }}</a><br>
        <small>by {{ t.author }}</small>
      </li>
      {% else %}
      <li class="list-group-item">No trending books</li>
      {% endfor %}
    </ul>

    <h6>Categories</h6>
    <ul class="list-group">
      <li class="list-group-item"><a href="{{ url_for('main.index') }}">All</a></li>
      {% for c in categories %}
      <li class="list-group-item"><a href="{{ url_for('main.index', category=c) }}">{{ c }}</a></li>
      {% endfor %}
      <!-- ðŸ’¬ Floating Chatbot Button -->
    <a href="{{ url_for('main.chatbot') }}" 
     class="btn btn-primary rounded-circle shadow-lg" 
     style="position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 24px;"
     data-bs-toggle="tooltip" title="Chat with us!">
     <i class="bi bi-robot"></i>
    </a>


    </ul>
  </div>
</div>
{% endblock %}
